#!/usr/bin/env bash

set -e

echo "[ bin/ci ] Running non E2E tests"
bin/test run --rebuild

echo "[ bin/ci ] Running JS tests"
bin/test js

echo "[ bin/ci ] Running E2E tests"
bin/test e2e --rebuild --rebuild-after

echo "[ bin/ci ] Analyzing Ruby gems for"
echo "[ bin/ci ] security vulnerabilities"
bundle exec bundle audit check --update

echo "[ bin/ci ] Checking to see that all classes have tests"
bin/test audit --ignore app/src/front_end/handlers/admin/base_handler.rb --ignore app/src/front_end/pages/admin/base_page.rb

echo "[ bin/ci ] Done"
